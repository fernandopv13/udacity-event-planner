<!DOCTYPE html>
<html>
	<head>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta charset="utf-8">
		

		<!--link href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet"-->
		<link rel="stylesheet" href="lib/bootstrap_v3.3.6/css/bootstrap.min.css">
		<link rel="stylesheet" href="lib/bootstrap-datetimepicker_v4.17.37/build/css/bootstrap-datetimepicker.css">
		<link rel="stylesheet" href="assets/css/materialize.css" media="screen"/>
		
		<script src="lib/jquery-2.1.1.min.js"></script>
		<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script-->
		<!--script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script-->
		<script src="lib/bootstrap_v3.3.6/js/bootstrap.min.js"></script>
		<script src="lib/modernizr_v3.3.1-matchmedia-inputtypes.js"></script>
		<!--script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script-->
		<script src="lib/moment.js_V2.12.0/min/moment-with-locales.min.js"></script>
		<script src="lib/bootstrap-datetimepicker_v4.17.37/build/js/bootstrap-datetimepicker.min.js"></script>
		<script src="assets/js/Device.js"></script>
		
		<script>

			function useCustomPicker() {

				var isMobile = false, hasNativePicker = false;

				['android', 'blackberry', 'bb10', 'iemobile', 'ipad', 'ipod', 'opera mini', 'mobile'].forEach(function(key) {

					isMobile = isMobile || window.navigator.userAgent.toLowerCase().indexOf(key) > -1;
				});

				hasNativePicker = Modernizr.inputtypes['datetime-local'];

				return isMobile && !hasNativePicker && typeof moment !== 'undefined' // prefer native datetime picker on mobile, if available

				|| !isMobile; // always prefer custom picker on desktop
			}

			
			function getDateTimeValue() {

				var data = $('#datetimepicker4').data(), date = null;

				if (typeof data.DateTimePicker !== 'undefined') { // we can access the DateTimePicker js object

					if (typeof moment !== 'undefined') { // moment is available

						if (data.DateTimePicker.date() && data.DateTimePicker.date().isValid()) { // we have a valid moment instance

							date = data.DateTimePicker.date() // get that moment
						}
					}
				}

				else { // parse the input's value manually

					date = $('#datetimepicker4').val();

					if (typeof moment !== 'undefined') { // use moment if available (probably won't work on mobile)

						date = moment(

							date,

							[ // try a number of expected formats, in order of likelyhood for en-us locale

								'YYYY-MM-DDTHH:mm', // ISO 8601

								'MM/DD/YYYY HH:mm A', // 12h, numbers only, US/North American date/month order

								'DD. MMM YYYY hh:mm A', // 12h/24h, month name, date/month order as used natively by iOS and x-OS Chrome

								'MM/DD/YYYY hh:mm:ss' // 12h, numbers only, UK/European date/month order
							],

							true
						);

						date = date.isValid() ? date : null;
					}
				}

				if (date === null) { // try to brute force parsing if moment - and all else - fails

					date = Date.parse(date);

					date = !isNaN(date) ? new Date(date): null;
				}

				return date;
			}


			function setup() {

				if (useCustomPicker()) { // use custom widget

					// initialize datetimepickers

					$('input[type="datetime-local"]').datetimepicker({

						//debug: true,

						focusOnShow: true, // give textbox focus when showing picker

						ignoreReadonly: true,

						locale: moment.locale('en')
					});

					// attach event handlers

					$('input[type="datetime-local"]').on('dp.change', function(nEvent) {

						$('#value').text(getDateTimeValue());
					});

					// enable direct editing in input box

					var data = $('#datetimepicker4').data();

					if (typeof data.DateTimePicker !== 'undefined') {

						data.DateTimePicker.enable(); // enable editing in input field

						data.DateTimePicker.options({keyBinds: null}) // remove all keyboard event handlers from picker
					}
					
					// suppress native datetimepicker (by changing input type to 'text')

					$('input[type="datetime-local"]').addClass('datetimepicker-input'); // add a dummy class so we can find the collection easily

					$('#datetimepicker4').attr('type','text'); // change the type to text
				}

				else { // use native widget

					// attach event handlers
					// note: short of manual polling, there seems to be very little support for 'changey' input events on mobile
					// but focus and blur seem to work, and be compatible with the native picker widgets, so working with them.

					$('#datetimepicker4').blur(function() { // placeholder until I get to the actual implementation

						$('#value').text(getDateTimeValue());
					});
				}
			};

		</script>

		<style>
			
			/* Override som defaults to make bootstrap-datetimepicker match Materialize's colour scheme  */

			a {
				color: #26a69a;
			}

			td.active,
			td.active:hover,
			td.second:hover,
			td.today {
				background-color: #26a69a !important;
			}

			.bootstrap-datetimepicker-widget {
				border: 1px solid #9e9e9e;
				/*border-radius: 3px;*/
				box-shadow: 3px 3px 5px #9e9e9e;
			}
		</style>
		
	</head>

	<body>
		
		<div style="position:relative;">
			
			<input id='datetimepicker4' type='datetime-local'>
			<input type="text"></input>
			<input id="thebtn" value="click me!" type="button"/>

		</div>

		<div id="value">value</div>

		<div id="device-height"></div>

		<div id="device-width"></div>

		<div id="mobile"></div>

		<div>
			
			<script>document.write('datetimepicker supported: ' +  Modernizr.inputtypes['datetime-local']);</script>

		</div>
		
		<script>

			window.onload = function() {
			
				setup();

				$('#thebtn').click(function() {

					$('#value').text(getDateTimeValue());

					console.log(getDateTimeValue());
				});

				//$('#device-height').text(window.matchMedia("(max-device-height: 1024px)").matches ? true : false); //'outerHeight: ' + window.outerHeight);

				//$('#device-width').text(window.matchMedia("(max-device-width: 1024px)").matches ? true : false); //'outerWidth: ' + window.outerWidth);

				$('#mobile').text('mobile: ' + (new app.Device()).isMobile());
				
			};

		</script>

	</body>

</html>